"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __values = (this && this.__values) || function (o) {
    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
    if (m) return m.call(o);
    return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var ReactDOM = require("react-dom");
var PropTypes = require("prop-types");
var react_form_with_constraints_1 = require("react-form-with-constraints");
exports.FormWithConstraints = react_form_with_constraints_1.FormWithConstraints;
var DisplayFields = (function (_super) {
    __extends(DisplayFields, _super);
    function DisplayFields() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.reRender = function () {
            _this.forceUpdate();
        };
        return _this;
    }
    DisplayFields.prototype.componentWillMount = function () {
        var form = this.context.form;
        form.fieldsStore.addListener(react_form_with_constraints_1.FieldEvent.Added, this.reRender);
        form.fieldsStore.addListener(react_form_with_constraints_1.FieldEvent.Removed, this.reRender);
        form.addFieldDidValidateEventListener(this.reRender);
        form.addFieldDidResetEventListener(this.reRender);
    };
    DisplayFields.prototype.componentWillUnmount = function () {
        var form = this.context.form;
        form.fieldsStore.removeListener(react_form_with_constraints_1.FieldEvent.Added, this.reRender);
        form.fieldsStore.removeListener(react_form_with_constraints_1.FieldEvent.Removed, this.reRender);
        form.removeFieldDidValidateEventListener(this.reRender);
        form.removeFieldDidResetEventListener(this.reRender);
    };
    DisplayFields.prototype.render = function () {
        var str = stringifyWithUndefinedAndWithoutPropertyQuotes(this.context.form.fieldsStore.fields, 2);
        str = str.replace(/{\s+key: (.*),\s+type: (.*),\s+show: (.*)\s+}/g, '{ key: $1, type: $2, show: $3 }');
        return React.createElement("pre", { style: { fontSize: 'small' } },
            "Fields = ",
            str);
    };
    DisplayFields.contextTypes = {
        form: PropTypes.instanceOf(react_form_with_constraints_1.FormWithConstraints).isRequired
    };
    return DisplayFields;
}(React.Component));
exports.DisplayFields = DisplayFields;
var stringifyWithUndefinedAndWithoutPropertyQuotes = function (obj, space) {
    var str = JSON.stringify(obj, function (_key, value) { return value === undefined ? '__undefined__' : value; }, space);
    str = str.replace(/"__undefined__"/g, 'undefined');
    str = str.replace(/"([^"]+)":/g, '$1:');
    return str;
};
var FieldFeedbacks = (function (_super) {
    __extends(FieldFeedbacks, _super);
    function FieldFeedbacks() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    FieldFeedbacks.prototype.render = function () {
        var _a = this.props, fieldName = _a.for, stop = _a.stop;
        var attr = '';
        if (fieldName)
            attr += "for=\"" + fieldName + "\" ";
        attr += "stop=\"" + stop + "\"";
        return (React.createElement(React.Fragment, null,
            React.createElement("li", null,
                "key=\"",
                this.key,
                "\" ",
                attr),
            React.createElement("ul", null, _super.prototype.render.call(this))));
    };
    return FieldFeedbacks;
}(react_form_with_constraints_1.FieldFeedbacks));
exports.FieldFeedbacks = FieldFeedbacks;
var FieldFeedback = (function (_super) {
    __extends(FieldFeedback, _super);
    function FieldFeedback() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    FieldFeedback.prototype.getTextDecoration = function () {
        var show = this.state.validation.show;
        var textDecoration = '';
        switch (show) {
            case false:
                textDecoration = 'line-through';
                break;
            case undefined:
                textDecoration = 'line-through dotted';
                break;
        }
        return textDecoration;
    };
    FieldFeedback.prototype.render = function () {
        var _a = this.state.validation, key = _a.key, type = _a.type;
        return (React.createElement("li", null,
            React.createElement("span", { style: { textDecoration: this.getTextDecoration() } },
                "key=\"",
                key,
                "\" type=\"",
                type,
                "\""),
            ' ',
            _super.prototype.render.call(this)));
    };
    FieldFeedback.prototype.componentDidUpdate = function () {
        var e_1, _a;
        var el = ReactDOM.findDOMNode(this);
        var fieldFeedbackSpans = el.querySelectorAll('[data-feedback]');
        try {
            for (var fieldFeedbackSpans_1 = __values(fieldFeedbackSpans), fieldFeedbackSpans_1_1 = fieldFeedbackSpans_1.next(); !fieldFeedbackSpans_1_1.done; fieldFeedbackSpans_1_1 = fieldFeedbackSpans_1.next()) {
                var fieldFeedbackSpan = fieldFeedbackSpans_1_1.value;
                fieldFeedbackSpan.style.display = 'inline';
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (fieldFeedbackSpans_1_1 && !fieldFeedbackSpans_1_1.done && (_a = fieldFeedbackSpans_1.return)) _a.call(fieldFeedbackSpans_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        var li = el.closest('li.async');
        if (li !== null) {
            var async = li.querySelector('span[style]');
            async.style.textDecoration = this.getTextDecoration();
        }
        var type = this.state.validation.type;
        if (type === react_form_with_constraints_1.FieldFeedbackType.WhenValid) {
            var span = el.querySelector('span[style]');
            var whenValid = el.querySelector("span." + this.props.classes.valid);
            span.style.textDecoration = whenValid !== null ? '' : 'line-through';
        }
    };
    return FieldFeedback;
}(react_form_with_constraints_1.FieldFeedback));
exports.FieldFeedback = FieldFeedback;
var Async = (function (_super) {
    __extends(Async, _super);
    function Async() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Async.prototype.getTextDecoration = function () {
        return 'line-through dotted';
    };
    Async.prototype.componentWillUpdate = function () {
        var el = ReactDOM.findDOMNode(this);
        var async = el.querySelector('span[style]');
        async.style.textDecoration = this.getTextDecoration();
    };
    Async.prototype.render = function () {
        return (React.createElement("li", { className: "async" },
            React.createElement("span", { style: { textDecoration: this.getTextDecoration() } }, "Async"),
            React.createElement("ul", null, _super.prototype.render.call(this))));
    };
    return Async;
}(react_form_with_constraints_1.Async));
exports.Async = Async;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGlzcGxheUZpZWxkcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9EaXNwbGF5RmllbGRzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkJBQStCO0FBQy9CLG9DQUFzQztBQUN0QyxzQ0FBd0M7QUFFeEMsMkVBT3FDO0FBMEQ1Qiw4QkFoRVAsaURBQW1CLENBZ0VPO0FBdEQ1QjtJQUFtQyxpQ0FBbUM7SUFBdEU7UUFBQSxxRUEyQ0M7UUFyQkMsY0FBUSxHQUFHO1lBQ1QsS0FBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JCLENBQUMsQ0FBQTs7SUFtQkgsQ0FBQztJQXJDQywwQ0FBa0IsR0FBbEI7UUFDVSxJQUFBLHdCQUFJLENBQWtCO1FBQzlCLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLHdDQUFVLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyx3Q0FBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsNkJBQTZCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCw0Q0FBb0IsR0FBcEI7UUFDVSxJQUFBLHdCQUFJLENBQWtCO1FBQzlCLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLHdDQUFVLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNqRSxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyx3Q0FBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkUsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLElBQUksQ0FBQyxRQUFR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O0lBQy9CLENBQUM7SUFFRCxtQ0FBbUIsR0FBbkI7UUFDRSxJQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBa0IsQ0FBQztRQUd2RCxJQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFrQixhQUFhLENBQUMsQ0FBQztRQUMvRCxLQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUN6RCxDQUFDO0lBRUQsc0JBQU0sR0FBTjtRQUNFLE9BQU8sQ0FDTCw0QkFBSSxTQUFTLEVBQUMsT0FBTztZQUNuQiw4QkFBTSxLQUFLLEVBQUUsRUFBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixFQUFFLEVBQUMsWUFBYztZQUNyRSxnQ0FDRyxpQkFBTSxNQUFNLFdBQUUsQ0FDWixDQUNGLENBQ04sQ0FBQztJQUNKLENBQUM7SUFDSCxZQUFDO0FBQUQsQ0FBQyxBQXZCRCxDQUE4QixtQ0FBTSxHQXVCbkM7QUF2Qlksc0JBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgKiBhcyBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0ICogYXMgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuXG5pbXBvcnQge1xuICBGb3JtV2l0aENvbnN0cmFpbnRzLFxuICBGb3JtV2l0aENvbnN0cmFpbnRzQ2hpbGRDb250ZXh0LFxuICBGaWVsZEZlZWRiYWNrIGFzIF9GaWVsZEZlZWRiYWNrLCBGaWVsZEZlZWRiYWNrVHlwZSxcbiAgRmllbGRGZWVkYmFja3MgYXMgX0ZpZWxkRmVlZGJhY2tzLFxuICBBc3luYyBhcyBfQXN5bmMsXG4gIEZpZWxkRXZlbnRcbn0gZnJvbSAncmVhY3QtZm9ybS13aXRoLWNvbnN0cmFpbnRzJztcblxuZXhwb3J0IGludGVyZmFjZSBEaXNwbGF5RmllbGRzUHJvcHMge31cblxuZXhwb3J0IGNsYXNzIERpc3BsYXlGaWVsZHMgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8RGlzcGxheUZpZWxkc1Byb3BzPiB7XG4gIHN0YXRpYyBjb250ZXh0VHlwZXM6IFJlYWN0LlZhbGlkYXRpb25NYXA8Rm9ybVdpdGhDb25zdHJhaW50c0NoaWxkQ29udGV4dD4gPSB7XG4gICAgZm9ybTogUHJvcFR5cGVzLmluc3RhbmNlT2YoRm9ybVdpdGhDb25zdHJhaW50cykuaXNSZXF1aXJlZFxuICB9O1xuICBjb250ZXh0ITogRm9ybVdpdGhDb25zdHJhaW50c0NoaWxkQ29udGV4dDtcblxuICBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLmNvbnRleHQ7XG4gICAgZm9ybS5maWVsZHNTdG9yZS5hZGRMaXN0ZW5lcihGaWVsZEV2ZW50LkFkZGVkLCB0aGlzLnJlUmVuZGVyKTtcbiAgICBmb3JtLmZpZWxkc1N0b3JlLmFkZExpc3RlbmVyKEZpZWxkRXZlbnQuUmVtb3ZlZCwgdGhpcy5yZVJlbmRlcik7XG4gICAgZm9ybS5hZGRGaWVsZERpZFZhbGlkYXRlRXZlbnRMaXN0ZW5lcih0aGlzLnJlUmVuZGVyKTtcbiAgICBmb3JtLmFkZEZpZWxkRGlkUmVzZXRFdmVudExpc3RlbmVyKHRoaXMucmVSZW5kZXIpO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLmNvbnRleHQ7XG4gICAgZm9ybS5maWVsZHNTdG9yZS5yZW1vdmVMaXN0ZW5lcihGaWVsZEV2ZW50LkFkZGVkLCB0aGlzLnJlUmVuZGVyKTtcbiAgICBmb3JtLmZpZWxkc1N0b3JlLnJlbW92ZUxpc3RlbmVyKEZpZWxkRXZlbnQuUmVtb3ZlZCwgdGhpcy5yZVJlbmRlcik7XG4gICAgZm9ybS5yZW1vdmVGaWVsZERpZFZhbGlkYXRlRXZlbnRMaXN0ZW5lcih0aGlzLnJlUmVuZGVyKTtcbiAgICBmb3JtLnJlbW92ZUZpZWxkRGlkUmVzZXRFdmVudExpc3RlbmVyKHRoaXMucmVSZW5kZXIpO1xuICB9XG5cbiAgcmVSZW5kZXIgPSAoKSA9PiB7XG4gICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGxldCBzdHIgPSBzdHJpbmdpZnlXaXRoVW5kZWZpbmVkQW5kV2l0aG91dFByb3BlcnR5UXVvdGVzKHRoaXMuY29udGV4dC5mb3JtLmZpZWxkc1N0b3JlLmZpZWxkcywgMik7XG5cbiAgICAvLyBDb3NtZXRpYzogaW1wcm92ZSBmb3JtYXR0aW5nXG4gICAgLy9cbiAgICAvLyBSZXBsYWNlIHRoaXMgc3RyaW5nOlxuICAgIC8vIHtcbiAgICAvLyAgIGtleTogXCIxLjBcIixcbiAgICAvLyAgIHR5cGU6IFwiZXJyb3JcIixcbiAgICAvLyAgIHNob3c6IHRydWVcbiAgICAvLyB9XG4gICAgLy8gd2l0aCB0aGlzOlxuICAgIC8vIHsga2V5OiBcIjEuMFwiLCB0eXBlOiBcImVycm9yXCIsIHNob3c6IHRydWUgfVxuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC97XFxzK2tleTogKC4qKSxcXHMrdHlwZTogKC4qKSxcXHMrc2hvdzogKC4qKVxccyt9L2csICd7IGtleTogJDEsIHR5cGU6ICQyLCBzaG93OiAkMyB9Jyk7XG5cbiAgICByZXR1cm4gPHByZSBzdHlsZT17e2ZvbnRTaXplOiAnc21hbGwnfX0+RmllbGRzID0ge3N0cn08L3ByZT47XG4gIH1cbn1cblxuLy8gU2VlIFByZXNlcnZpbmcgdW5kZWZpbmVkIHRoYXQgSlNPTi5zdHJpbmdpZnkgb3RoZXJ3aXNlIHJlbW92ZXMgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xLzI2NTQwNzA2XG4vLyBTZWUgSlNPTi5zdHJpbmdpZnkgd2l0aG91dCBxdW90ZXMgb24gcHJvcGVydGllcz8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xLzExMjMzNDk4XG5jb25zdCBzdHJpbmdpZnlXaXRoVW5kZWZpbmVkQW5kV2l0aG91dFByb3BlcnR5UXVvdGVzID0gKG9iajogb2JqZWN0LCBzcGFjZT86IHN0cmluZyB8IG51bWJlcikgPT4ge1xuICBsZXQgc3RyID0gSlNPTi5zdHJpbmdpZnkob2JqLCAoX2tleSwgdmFsdWUpID0+IHZhbHVlID09PSB1bmRlZmluZWQgPyAnX191bmRlZmluZWRfXycgOiB2YWx1ZSwgc3BhY2UpO1xuICBzdHIgPSBzdHIucmVwbGFjZSgvXCJfX3VuZGVmaW5lZF9fXCIvZywgJ3VuZGVmaW5lZCcpO1xuICBzdHIgPSBzdHIucmVwbGFjZSgvXCIoW15cIl0rKVwiOi9nLCAnJDE6Jyk7XG4gIHJldHVybiBzdHI7XG59O1xuXG5leHBvcnQgeyBGb3JtV2l0aENvbnN0cmFpbnRzIH07XG5cbmV4cG9ydCBjbGFzcyBGaWVsZEZlZWRiYWNrcyBleHRlbmRzIF9GaWVsZEZlZWRiYWNrcyB7XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGZvcjogZmllbGROYW1lLCBzdG9wIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgbGV0IGF0dHIgPSAnJztcbiAgICBpZiAoZmllbGROYW1lKSBhdHRyICs9IGBmb3I9XCIke2ZpZWxkTmFtZX1cIiBgO1xuICAgIGF0dHIgKz0gYHN0b3A9XCIke3N0b3B9XCJgO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDw+XG4gICAgICAgIDxsaT5rZXk9XCJ7dGhpcy5rZXl9XCIge2F0dHJ9PC9saT5cbiAgICAgICAgPHVsPlxuICAgICAgICAgIHtzdXBlci5yZW5kZXIoKX1cbiAgICAgICAgPC91bD5cbiAgICAgIDwvPlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZpZWxkRmVlZGJhY2sgZXh0ZW5kcyBfRmllbGRGZWVkYmFjayB7XG4gIHByaXZhdGUgZ2V0VGV4dERlY29yYXRpb24oKSB7XG4gICAgY29uc3QgeyBzaG93IH0gPSB0aGlzLnN0YXRlLnZhbGlkYXRpb247XG5cbiAgICBsZXQgdGV4dERlY29yYXRpb24gPSAnJztcbiAgICBzd2l0Y2ggKHNob3cpIHtcbiAgICAgIGNhc2UgZmFsc2U6XG4gICAgICAgIHRleHREZWNvcmF0aW9uID0gJ2xpbmUtdGhyb3VnaCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB1bmRlZmluZWQ6XG4gICAgICAgIHRleHREZWNvcmF0aW9uID0gJ2xpbmUtdGhyb3VnaCBkb3R0ZWQnO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gdGV4dERlY29yYXRpb247XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBrZXksIHR5cGUgfSA9IHRoaXMuc3RhdGUudmFsaWRhdGlvbjtcblxuICAgIHJldHVybiAoXG4gICAgICA8bGk+XG4gICAgICAgIDxzcGFuIHN0eWxlPXt7dGV4dERlY29yYXRpb246IHRoaXMuZ2V0VGV4dERlY29yYXRpb24oKX19PmtleT1cIntrZXl9XCIgdHlwZT1cInt0eXBlfVwiPC9zcGFuPnsnICd9XG4gICAgICAgIHtzdXBlci5yZW5kZXIoKX1cbiAgICAgIDwvbGk+XG4gICAgKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICBjb25zdCBlbCA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpIGFzIEhUTUxMSUVsZW1lbnQ7XG5cbiAgICAvLyBIYWNrOiBtYWtlIEZpZWxkRmVlZGJhY2sgPHNwYW4gc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmVcIj5cbiAgICAvLyBBbHNvIG1ha2UgQm9vdHN0cmFwIDQgaGFwcHkgYmVjYXVzZSBpdCBzZXRzICdkaXNwbGF5OiBub25lJywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL3Y0LjEuMi9zY3NzL21peGlucy9fZm9ybXMuc2NzcyNMMzFcbiAgICBjb25zdCBmaWVsZEZlZWRiYWNrU3BhbnMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxTcGFuRWxlbWVudD4oJ1tkYXRhLWZlZWRiYWNrXScpO1xuICAgIGZvciAoY29uc3QgZmllbGRGZWVkYmFja1NwYW4gb2YgZmllbGRGZWVkYmFja1NwYW5zKSB7XG4gICAgICBmaWVsZEZlZWRiYWNrU3Bhbi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7XG4gICAgfVxuXG4gICAgLy8gQ2hhbmdlIEFzeW5jIHBhcmVudCBzdHlsZVxuICAgIGNvbnN0IGxpID0gZWwuY2xvc2VzdCgnbGkuYXN5bmMnKTtcbiAgICBpZiAobGkgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGFzeW5jID0gbGkucXVlcnlTZWxlY3RvcjxIVE1MU3BhbkVsZW1lbnQ+KCdzcGFuW3N0eWxlXScpO1xuICAgICAgYXN5bmMhLnN0eWxlLnRleHREZWNvcmF0aW9uID0gdGhpcy5nZXRUZXh0RGVjb3JhdGlvbigpO1xuICAgIH1cblxuICAgIC8vIENoYW5nZSB3aGVuVmFsaWQgc3R5bGVcbiAgICBjb25zdCB7IHR5cGUgfSA9IHRoaXMuc3RhdGUudmFsaWRhdGlvbjtcbiAgICBpZiAodHlwZSA9PT0gRmllbGRGZWVkYmFja1R5cGUuV2hlblZhbGlkKSB7XG4gICAgICBjb25zdCBzcGFuID0gZWwucXVlcnlTZWxlY3RvcjxIVE1MU3BhbkVsZW1lbnQ+KCdzcGFuW3N0eWxlXScpO1xuICAgICAgY29uc3Qgd2hlblZhbGlkID0gZWwucXVlcnlTZWxlY3RvcjxIVE1MU3BhbkVsZW1lbnQ+KGBzcGFuLiR7dGhpcy5wcm9wcy5jbGFzc2VzIS52YWxpZH1gKTtcbiAgICAgIHNwYW4hLnN0eWxlLnRleHREZWNvcmF0aW9uID0gd2hlblZhbGlkICE9PSBudWxsID8gJycgOiAnbGluZS10aHJvdWdoJztcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFzeW5jPFQ+IGV4dGVuZHMgX0FzeW5jPFQ+IHtcbiAgcHJpdmF0ZSBnZXRUZXh0RGVjb3JhdGlvbigpIHtcbiAgICByZXR1cm4gJ2xpbmUtdGhyb3VnaCBkb3R0ZWQnO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVwZGF0ZSgpIHtcbiAgICBjb25zdCBlbCA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpIGFzIEhUTUxMSUVsZW1lbnQ7XG5cbiAgICAvLyBSZXNldCBzdHlsZVxuICAgIGNvbnN0IGFzeW5jID0gZWwucXVlcnlTZWxlY3RvcjxIVE1MU3BhbkVsZW1lbnQ+KCdzcGFuW3N0eWxlXScpO1xuICAgIGFzeW5jIS5zdHlsZS50ZXh0RGVjb3JhdGlvbiA9IHRoaXMuZ2V0VGV4dERlY29yYXRpb24oKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGxpIGNsYXNzTmFtZT1cImFzeW5jXCI+XG4gICAgICAgIDxzcGFuIHN0eWxlPXt7dGV4dERlY29yYXRpb246IHRoaXMuZ2V0VGV4dERlY29yYXRpb24oKX19PkFzeW5jPC9zcGFuPlxuICAgICAgICA8dWw+XG4gICAgICAgICAge3N1cGVyLnJlbmRlcigpfVxuICAgICAgICA8L3VsPlxuICAgICAgPC9saT5cbiAgICApO1xuICB9XG59XG4iXX0=